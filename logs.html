<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Logs - Harvestive</title>
<style>
  body { font-family: Arial, sans-serif; background:#fff; color:#333; margin:0; padding:0; }
  header { background:#d4af37; color:#fff; padding:20px; text-align:center; }
  h1 { margin:0; }
  main { padding:20px; }
  .log-section { margin-bottom:40px; }
  .log-section h2 { color:#d4af37; border-bottom:2px solid #d4af37; padding-bottom:5px; }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  thead th { background:#d4af37; color:#fff; padding:10px; text-align:left; }
  tbody td { border-bottom:1px solid #ccc; padding:10px; }
  tr:nth-child(even) { background:#fef9f0; }
  .receipt { max-width:80px; border:1px solid #d4af37; border-radius:5px; }
  .error { color:red; text-align:center; margin-top:20px; }
</style>
</head>
<body>
<header>
  <h1>My Account Logs</h1>
</header>

<main>
  <section class="log-section">
    <h2>Deposits</h2>
    <table id="deposits-table">
      <thead>
        <tr>
          <th>ID</th><th>Amount (USD)</th><th>Method</th><th>Status</th><th>Screenshot</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <section class="log-section">
    <h2>Withdrawals</h2>
    <table id="withdrawals-table">
      <thead>
        <tr>
          <th>ID</th><th>Amount (USD)</th><th>Method</th><th>Address</th><th>Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <section class="log-section">
    <h2>Investments</h2>
    <table id="investments-table">
      <thead>
        <tr>
          <th>ID</th><th>Amount (USD)</th><th>Date</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <p class="error" id="errorMsg"></p>
</main>

<script>
(async function loadLogs() {
  const token = localStorage.getItem('token');
  const errorEl = document.getElementById('errorMsg');
  errorEl.textContent = '';

  if (!token) {
    errorEl.textContent = 'You must log in first';
    return;
  }

  try {
    const res = await fetch('https://harvestive-com.onrender.com/user/logs', {
      headers: { 'Authorization': `Bearer ${token}` }
    });

    const text = await res.text();
    let data;
    try {
      data = JSON.parse(text);
    } catch {
      throw new Error('Server returned HTML instead of JSON. Check backend URL or server.');
    }

    if (!data.success) throw new Error(data.message || 'Error loading logs');

    // Deposits
    const depositsBody = document.querySelector('#deposits-table tbody');
    depositsBody.innerHTML = '';
    data.deposits.forEach(d => {
      depositsBody.innerHTML += `
        <tr>
          <td>${d.id}</td>
          <td>${d.amount.toLocaleString()}</td>
          <td>${d.method}</td>
          <td>${d.status}</td>
          <td>${d.screenshot ? `<img src="/uploads/${d.screenshot}" class="receipt">` : '-'}</td>
        </tr>`;
    });

    // Withdrawals
    const withdrawalsBody = document.querySelector('#withdrawals-table tbody');
    withdrawalsBody.innerHTML = '';
    data.withdrawals.forEach(w => {
      withdrawalsBody.innerHTML += `
        <tr>
          <td>${w.id}</td>
          <td>${w.amount.toLocaleString()}</td>
          <td>${w.method}</td>
          <td>${w.address}</td>
          <td>${w.status}</td>
        </tr>`;
    });

    // Investments
    const investBody = document.querySelector('#investments-table tbody');
    investBody.innerHTML = '';
    data.investments.forEach(i => {
      investBody.innerHTML += `
        <tr>
          <td>${i.id}</td>
          <td>${i.amount.toLocaleString()}</td>
          <td>${new Date(i.createdAt).toLocaleString()}</td>
        </tr>`;
    });

  } catch (err) {
    console.error(err);
    errorEl.textContent = err.message;
  }
})();
</script>
</body>
</html>